<!DOCTYPE html>

<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width">
        <title></title>

        <link href="lib/ionic/css/ionic.css" rel="stylesheet">
        <link href="css/history.css" rel="stylesheet">
               
        <!-- ionic/angularjs js -->
        <script src="lib/ionic/js/ionic.bundle.js"></script>

        <!-- cordova script (this will be a 404 during development) -->
        <script src="cordova.js"></script>

        <!-- JQuery and Firebase libraries -->
        <script src='https://cdn.firebase.com/js/client/2.2.1/firebase.js'></script>
        <script src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js'></script>
        
        <!-- your app's js -->
        <script src="js/app.js"></script>
    </head>
    
    <body ng-app="pedometer">
        <!-- Header -->
        <ion-header-bar align-title="center" class="bar-stable">
            <h1 class="title">Steps Academy</h1>
            <div class="buttons" id="logout">
                <button class="button button-assertive">Log out</button>
            </div>
        </ion-header-bar>
        
        <!-- Main content -->
        <ion-content padding="true">
            <!-- User history -->
            <div class="history">
                <div class="header">
                    <h3>History</h3>
                </div>
                <div id="history">
                    <div class="row">
                        <div class="col"><strong>Name</strong></div>
                        <div class="col"><strong>Steps</strong></div>
                        <div class="col"><strong>Duration</strong></div>
                    </div>
                </div>
            </div>
            <!-- Start button -->
            <a href="selftest.html">
                <div class="start">
                    <h3>Start New</h3>
                </div>
            </a>
        </ion-content>
        
        <script>
            $('document').ready(function(){
                $('#logout').click(function(){
                    sessionStorage.clear();
                    window.location.href = "index.html"
                });
                var ref = new Firebase('https://glaring-inferno-4440.firebaseio.com/Users/' + sessionStorage.user);
               
                ref.on('value', function(snapshot){
                    var hasActivities = snapshot.hasChild("activities");
                    if(hasActivities){
                        ref.child('activities').on('child_added', function(snap){
                            var row = document.createElement('div');
                            row.className = "row";
                        
                            var name = document.createElement('div');
                            name.className = "col";
                            name.innerHTML = snap.val().name;
                    
                            var steps = document.createElement('div');
                            steps.className = "col";
                            steps.innerHTML = snap.val().steps;

                            var startDate = new Date(parseInt(snap.val().start_date) * 1000);
                            var endDate = new Date(parseInt(snap.val().end_date) * 1000);
                            var duration = document.createElement('div');
                            duration.className = "col";
                            duration.innerHTML = endDate.getHours() - startDate.getHours();
                        
                            row.appendChild(name);
                            row.appendChild(steps);
                            row.appendChild(duration);
                        
                            $('#history').append(row);
                        });
                        
                    }else{
                        console.log("Nothing yet");
                    }
                });
            });
        </script>
    </body>
</html>